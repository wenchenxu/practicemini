<!-- 仅广州显示：选择分公司（必选） -->
<view wx:if="{{mode==='create' && showBranchPicker}}" class="form-item">
  <view class="label">分公司</view>
  <picker mode="selector" 
          range="{{branchOptions}}" 
          range-key="name" 
          value="{{branchIndex}}" 
          bindchange="onPickBranch">
    <view class="picker-value">
        {{ branchIndex>=0 ? branchOptions[branchIndex].name : '请选择' }}
    </view>
  </picker>
</view>

<!-- 合同类型：城市多类型则展示；仅一种则隐藏但会自动赋值 -->
<view wx:if="{{mode==='create' && showTypePicker}}" class="form-item">
  <view class="label">合同类型</view>
  <picker mode="selector" 
          range="{{typeOptions}}" 
          range-key="name" 
          value="{{typeIndex}}" 
          bindchange="onPickType">
    <view class="picker-value">
        {{ typeIndex>=0 ? typeOptions[typeIndex].name : '请选择' }}
    </view>
  </picker>
</view>

<!-- 编辑/查看模式：只读合同类型展示，不可交互 -->
<view wx:elif="{{mode!=='create'}}" class="readonly-field">
  <text class="label">合同类型</text>
  <text class="value">{{ selectedTypeName || '—' }}</text>
</view>

<view class="container">
  <view class="header">
    <text class="city">{{city}}</text>
    <text class="mode" wx:if="{{mode === 'view'}}">（查看）</text>
    <text class="mode" wx:if="{{mode === 'edit'}}">（编辑）</text>
  </view>

  <form bindsubmit="onSubmit">
    <block wx:for="{{visibleFields || []}}" wx:key="name">
      <block wx:if="{{!(mode==='create' && item.hideOnCreate)}}">
        <view class="form-item">
          <label class="label">
            <text wx:if="{{item.required}}" class="req">*</text>{{item.label}}
            <text class="tip" wx:if="{{item.help}}">（{{item.help}}）</text>
          </label>

          <!-- string -->
          <input
            wx:if="{{item.type==='string'}}"
            class="input"
            placeholder="请输入{{item.label}}"
            value="{{form[item.name] || ''}}"
            bindinput="onInput"
            data-name="{{item.name}}"
            disabled="{{item.disabled || mode==='view'}}"
            maxlength="{{item.maxLength || -1}}"
          />

          <!-- number -->
          <input
            wx:elif="{{item.type==='number'}}"
            class="input"
            type="number"
            placeholder="请输入{{item.label}}"
            value="{{form[item.name] !== undefined ? form[item.name] : ''}}"
            bindinput="onInputNumber"
            data-name="{{item.name}}"
            disabled="{{item.disabled || mode==='view'}}"
          />

          <!-- date -->
          <picker
            wx:elif="{{item.type==='date'}}"
            mode="date"
            value="{{form[item.name] || ''}}"
            bindchange="onDateChange"
            data-name="{{item.name}}"
            disabled="{{item.disabled || mode==='view'}}"
          >
            <view class="picker">{{form[item.name] || ('请选择' + item.label)}}</view>
          </picker>
        </view>
      </block>
    </block>

    <!---
    <view class="btn-row" wx:if="{{mode!=='view'}}">
      <button formType="submit" type="primary" class="btn">保存</button>
    </view>
    --->

    <view wx:if="{{mode!=='view'}}" class="footer-actions">
      <button type="primary" bindtap="onSubmit" loading="{{saving}}">
        {{ mode==='create' ? '生成合同': '保存并生成' }}
      </button>
    </view>
  </form>
  
  <view class="btn-row" wx:if="{{mode==='view'}}">
    <button type="default" class="btn" bindtap="toEdit">修改</button>
  </view>
</view>
