<!--pages/dev-tools/index.wxml-->
<view class="container">
  <view class="header">数据库维护工具</view>
  
  <view class="card">
    <view class="title">车辆去重</view>
    <view class="desc">
      检测数据库中 `plate` (车牌) 相同的记录。
      如果有重复，将保留“更新时间”最近的一条，自动删除其余旧数据。
    </view>
    <button type="warn" bindtap="onDeduplicateVehicles" loading="{{loading}}">
      执行去重 (按车牌)
    </button>
  </view>
  
  <view class="card">
    <view class="title">日期格式修复</view>
    <view class="desc">
      扫描所有车辆，将 `createdAt` 字段从字符串 (如 "2025-10-25") 转换为标准的数据库日期对象 (Date)，以便正确排序。
    </view>
    <button type="primary" bindtap="onFixDates" loading="{{loading}}">
      修复日期格式
    </button>
  </view>

  <view class="card danger-zone">
    <view class="title danger-text">⚠️ 删库 (按城市)</view>
    <view class="desc">
      输入城市代码 (如 suzhou)，并输入确认口令，将<text style="font-weight:bold;">永久删除</text>该城市下的所有车辆数据。
    </view>
    
    <view class="input-group">
      <view class="label">目标城市 (cityCode):</view>
      <input class="input" placeholder="cityCode" bindinput="onInputDeleteCity" value="{{delCity}}"/>
    </view>

    <view class="input-group">
      <view class="label">确认口令:</view>
      <input class="input" placeholder="are you sure?" bindinput="onInputDeleteConfirm" value="{{delConfirm}}"/>
    </view>

    <button type="warn" bindtap="onDeleteByCity" loading="{{loading}}" disabled="{{!canDelete}}">
      确认彻底删除
    </button>
  </view>

  </view>