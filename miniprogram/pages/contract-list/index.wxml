<view class="container">
  <view class="header">
    <text class="title">{{city}} - 合同历史</text>
  </view>

  <view wx:if="{{loading}}" class="empty">加载中...</view>
  <view wx:elif="{{list.length === 0}}" class="empty">暂无合同</view>

  <block wx:for="{{list}}" wx:key="_id">
    <view class="row">
      <view class="meta">
        <!-- 有文件：可点 -->
        <view
            wx:if="{{ item.file && (item.file.pdfFileID || item.file.docxFileID) }}"
            class="primary clickable"
            bindtap="openDocFromRow"
            data-id="{{item._id}}"
        >
          {{item.fields.clientName || '（未命名）'}} - {{item.fields.carPlate || '无牌照'}}
        </view>
        <!-- 无文件：禁用态 -->
        <view wx:else class="primary disabled">
            {{item.fields.clientName || '（未命名）'}} - {{item.fields.carPlate || '无牌照'}}
        </view>
        <view class="sub">
          编号：{{item.fields.contractSerialNumberFormatted || '—'}} ｜签约：{{item.fields.contractDate || '—'}}
        </view>
        <view class="sub">
            {{item.branchName || '—'}} ｜ {{item.contractTypeName || '—'}}
        </view>
      </view>
      <view class="ops">
        <view class="icon-btn" hover-class="icon-btn--hover" bindtap="editOne" data-id="{{item._id}}">
            <image class="icon" src="/assets/icons/edit64.png" mode="widthFix" />
        </view>
        <view class="icon-btn danger" hover-class="icon-btn--hover" bindtap="delOne" data-id="{{item._id}}">
            <image class="icon" src="/assets/icons/delete64.png" mode="widthFix" />
        </view>
      </view>
    </view>
  </block>

  <view class="load-more" wx:if="{{hasMore}}">
    <button size="mini" bindtap="loadMore">加载更多</button>
  </view>
</view>
